---
layout: post
title:  "新バージョンリリース: v2.1.0"
date:   2023-09-29 12:00:00+0900
categories: Package update
---

*jageocoder v2.1.0* をリリースしました。

v2.1.0 では自治体合併などによる住所の変更に対応しました。
旧住所で検索すると、新住所での検索結果を返します（例：
「与野市下落合5丁目7番10号」->
「埼玉県さいたま市中央区大字下落合五丁目7番10号」）。

- 自動的に新住所に変換したくない場合は、環境変数
`JAGEOCODER_OPT_AUTO_REDIRECT` に `off` をセットしてください。
デフォルトは `on` です。
- 2005年10月1日 以降の合併・編入・政令市移行・地域自治区廃止による
住所の変更に対応しています。丁割りなどの区画変更や住居表示実施による
住所の変更には対応できません（情報がないため）。
- 2005年9月以前の情報は逐次調査・登録中です。次回以降のデータ更新で
少しずつ過去にさかのぼっていく予定です。

住所の変更への対応に伴い、以下の仕様変更を行いました。

- 無名大字（直接地番）を導入しました。
    - たとえば旧「波田町」の役場は「（長野県東筑摩郡）波田町4417番地1」で
    町名「波田町」の後に大字が無く、直接「4417番地」が続きます。
    - 2010年4月1日に松本市に合併された際に波田町の地域は「松本市波田」に
    なったため、jageocoder では「（波田町の）無名大字」が
    「（松本市の）波田」という大字に変わった、と処理しています。
    - v2.1 の住所データファイルには無名大字が含まれているため、
    v2.0 では正しく処理できません。

- 「字」の省略処理を少し厳密にしました。
    - 字の省略（`JAGEOCODER_OPT_AZA_SKIP`）はこれまで通り `off`/`on`/
      `auto` の三段階ですが、処理内容が変わっています。
    - `off` の場合はこれまでと同じで「字」は常に省略しません。
    - `auto` の場合、これまではアドレス・ベース・レジストリを参照し、
      確実に省略できないことが分かっている「字」以外は省略可能と
      しましたが、v2.1 からは確実に省略できることが分かっている
      「字」のみ省略可能とします。たとえばアドレス・ベース・レジストリに
      記載のない小字はこれまでは省略可能でしたが、省略不可能になります。
    - `on` の場合、これまでは常に省略可能としていましたが、 v2.1 からは
      アドレス・ベース・レジストリを参照して確実に省略できないことが
      分かっている「字」は省略不可能とします。これはこれまでの
      `auto` と同じ処理です。
